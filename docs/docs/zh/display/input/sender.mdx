import SenderDemo from '../../../../components/Sender/SenderDemo';
import { Sender } from '@matechat/react';


# Sender 发送

> 这是一个带发送按钮和自动高度文本框的消息输入组件。

## 组件演示
<div className="playground-wrapper">
    <SenderDemo/>
</div>
```ts title="代码 示例"
import React from "react";
import { Sender } from "@matechat/react"; // 假设 Sender 代码在同目录 Sender.tsx

// 模拟后端接口类型
const fakeBackend = {
  input: (message: string, options: { callbacks: { onFinish: () => void }; signal: AbortSignal }) => {
    console.log("发送消息:", message);
    return new Promise<void>((resolve) => {
      setTimeout(() => {
        options.callbacks.onFinish();
        resolve();
      }, 1500);
    });
  },
};

export default function SenderDemo() {
  return (
    <div>
      <Sender
        className='w-full'
        initialMessage="Hello, MateChat!"
        placeholder="输入消息，按 Enter 发送"
        input={fakeBackend.input}
        onMessageChange={(msg) => {
          console.log("内容变化:", msg);
        }}
        onSend={(controller) => {
          console.log("消息发送开始，AbortController 可用于取消请求", controller);
        }}
      />
    </div>
  );
}

```

## Sender演示
<Playground
  code={`
import React, { useState } from "react";
import { Sender, SenderButton } from "@matechat/react"; // 调整为实际路径

// 模拟异步发送函数，支持取消
const fakeBackendInput = (message, { callbacks, signal }) => {
  console.log("发送消息:", message);

  return new Promise<void>((resolve, reject) => {
    const timer = setTimeout(() => {
      callbacks.onFinish();
      resolve();
    }, 2000);

    signal.addEventListener("abort", () => {
      clearTimeout(timer);
      console.log("发送取消");
      reject(new Error("发送取消"));
    });
  });
};

export default function SenderPlayground() {
  const [isSending, setIsSending] = useState(false);
  const [abortController, setAbortController] = useState<AbortController | null>(null);
  const [lastMessage, setLastMessage] = useState("");

  // 发送按钮点击事件
  const handleSendClick = () => {
    if (isSending && abortController) {
      // 正在发送，点击停止 => 取消发送
      abortController.abort();
      setIsSending(false);
      setAbortController(null);
      return;
    }
    // 非发送状态，什么都不做，这里不直接触发发送，由 Sender 组件处理
  };

  return (
    <div style={{ maxWidth: 480, margin: "2rem auto", fontFamily: "sans-serif" }}>
      <h2 className="mb-4 text-lg font-bold">Sender 组件 Playground 演示</h2>

      <Sender
        initialMessage="这是默认消息"
        placeholder="请输入你的消息，按 Enter 发送"
        input={fakeBackendInput}
        onMessageChange={(msg) => {
          console.log("内容变更:", msg);
        }}
        onSend={(controller) => {
          setIsSending(true);
          setAbortController(controller);
          setLastMessage("正在发送...");
          console.log("发送开始，AbortController 已保存");
          // 注意：这里不能直接用controller.signal监听结束事件，要依赖 input 的回调
        }}
      />

      {/* <div className="mb-4">
        <strong>状态:</strong> {isSending ? "发送中..." : "空闲"}
      </div>
      <div className="mb-4">
        <strong>最近发送消息:</strong> {lastMessage || "无"}
      </div> */}
      
      <div className="mb-4" style={{display: "flex",margin: "2rem auto"}}>
        <strong style={{marginRight: "10px"}}> Sender 按钮 </strong>

        <SenderButton
          isSending={isSending}
          onClick={handleSendClick}
          aria-label={isSending ? "停止发送" : "发送"}
        />
      </div>
    </div>
  );
}
`}
  language="tsx"
  title="List 参数演示"
  style={{
    height: 700
  }}
/>

## 参数说明

### SenderButton 组件参数说明 
| 参数名         | 类型                  | 默认值         | 描述                                                          |
| ----------- | ------------------- | ----------- | ----------------------------------------------------------- |
| `icon`      | `React.ReactNode`   | `undefined` | 按钮内显示的图标。默认：`isSending` 为 `false` 显示发送图标，`true` 显示停止图标。可覆盖。 |
| `isSending` | `boolean`           | `false`     | 是否处于发送中状态。`true` 显示停止图标，`false` 显示发送图标。                     |
| 其他          | 继承自 `button` 元素所有属性 |             | 其他原生 button 属性，如 `onClick`, `className` 等                   |

## Sender 组件参数说明
| 参数名               | 类型                                                                                                                  | 默认值                           | 描述                                                        |
| ----------------- | ------------------------------------------------------------------------------------------------------------------- | ----------------------------- | --------------------------------------------------------- |
| `initialMessage`  | `string`                                                                                                            | `""`                          | 输入框的初始内容                                                  |
| `placeholder`     | `string`                                                                                                            | `"Type your message here..."` | 输入框的占位提示文字                                                |
| `input`           | `(message: string, options: { callbacks: { onFinish: () => void }; signal: AbortSignal }) => void \| Promise<void>` | 必填                            | 输入处理函数，执行消息发送逻辑。参数包括消息文本和包含 `onFinish` 回调及 `AbortSignal`。 |
| `onMessageChange` | `(message: string) => void`                                                                                         | `undefined`                   | 消息内容变化回调，每次输入框内容变动都会调用                                    |
| `onSend`          | `(controller: AbortController) => void`                                                                             | `undefined`                   | 点击发送按钮时触发，传入 `AbortController`，可用于取消发送                    |
| 其他                | 继承自 `div` 元素所有属性                                                                                                    |                               | 其他原生 div 属性，如 `className`, `style` 等                      |
